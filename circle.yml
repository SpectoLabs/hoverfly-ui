machine:
  services:
    - docker
  environment:
#  Suppress cli progress logging
    TERM: dumb
  node:
    version: 6.9.0

dependencies:
  pre:
    - wget -q -O - https://dl-ssl.google.com/linux/linux_signing_key.pub | sudo apt-key add -
    - sudo sh -c 'echo "deb http://dl.google.com/linux/chrome/deb/ stable main" >> /etc/apt/sources.list.d/google.list'
    - sudo apt-get update
    - sudo apt-get install google-chrome-stable
    - curl https://raw.githubusercontent.com/SpectoLabs/hoverfly/hoverfly-install-script-linux/scripts/get_hoverfly_for_linux.sh > get_hoverfly.sh
    - chmod 700 get_hoverfly.sh && ./get_hoverfly.sh

test:
  override:
    - "make test"

deployment:
  release:
    tag: /v[0-9]+(\.[0-9]+)*/
    commands:
      - "make build"
      - "mv dist.zip $CIRCLE_TAG.zip"
      - "go get github.com/aktau/github-release"
      - "github-release upload  --user SpectoLabs --repo hoverfly-ui --tag $CIRCLE_TAG --name $CIRCLE_TAG.zip --file $CIRCLE_TAG.zip"
